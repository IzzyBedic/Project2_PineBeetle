---
title: "Predicting the Minimum Linear Distance from a Given Pine Tree to the Nearest Tree that is Infected by Pine Beetles"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    source_code: embed
    theme: yeti
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(readxl)
library(GGally) # ggpairs
library(vip)
library(tidymodels)
library(DT) # datatable
```

Read Me
==============================================================================

Row {data-height=700}
-----------------------------------------------------------------------

### What are Pine Beetles? And Why Are You Reading This?

__*Read me before proceeding to the analysis!*__

Pine Beetles are insects that can cause devastation to forests by eating into tree bark and upsetting the flow of water and nutrients to infected trees. Pine Beetles cause economic and ecological harm, so it's important to figure out how to protect forests from them.
<br>
</br>
There are five categories of variables shown on the Variable Chart page, which is accessed through the tabs at the top of this page: Tree diameter, infestation severity, nearest brood tree, forest density, and beetle population pressure.
<br>
</br>
Knowing how these variables relate to each other can help foresters figure out how to protect forests. For example, in this analysis, I will make two models for predicting the minimum linear distance to the nearest brood tree, or DeadDist. In other words, how far away from an infected tree can a given healthy tree be to be considered "safe"? This is important for foresters so that they don't clear trees unnecessarily and know when to expect tree death.

### Pine Beetle characteristics that might be relevant to our analysis

* Female Pine Beetles use pheromones to attract other Pine Beetles nearby when they are ready to lay eggs<sup>1</sup>
  + Pine Beetles will tend to attack as a group and infected trees will cause more infection around them (a reason to include infestation severity and nearest brood tree variables)
<br>
</br>
* Pine Beetles infestations in forests are usually directional<sup>1</sup>
<br>
</br>
* Most Pine Beetles like attacking bigger trees (>10in), but when there is a lot of competition for trees, they will attack smaller trees<sup>2</sup>
  + May be wise to include TreeDiam as a variable!
<br>
</br>
* Pine Beetles usually fly 300 feet or less at a time
  + 300 feet = ~.007 acres, which means that we will probably not want to use any of the beetle population pressure measures of over the smallest variable measure (1/20 acres = .05 acres)<sup>2</sup>


Row {data-height=200}
-----------------------------------------------------------------------

### Sources
1. [Basic Pine Beetle info](https://www.treefarmsystem.org/SPBwhenbeetlesattack)
2. [Pine Beetle FAQ USDA](https://www.fs.usda.gov/Internet/FSE_DOCUMENTS/stelprdb5304956.pdf)
3. [Stand Density Index info](https://fennerschool-associated.anu.edu.au/mensuration/density.html)

Data Exploration
==============================================================================

Row {data-height=300}
-----------------------------------------------------------------------

### Data table, explore how the raw data looks!

```{r readindata}
pine_tbl <- read_excel("../../hgen-612_temp/p1/data/Data_1993.xlsx", sheet = 1)
```

```{r makeshowcasebones}
pine_tbl %>% 
  dplyr::select(DeadDist, TreeDiam, Infest_Serv1, SDI_20th, BA_Inf_20th) %>% 
  DT::datatable()
```


Row {data-height=450}
-----------------------------------------------------------------------

### Factors related to Pine Beetle infestation in forests as they relate to each other when a tree within 1/20th acres is infested vs not

```{r ggpairs}
pine_fact_tbl <- pine_tbl %>% 
  mutate(IND_BA_Infest_20th_fac = factor(IND_BA_Infest_20th,
                              levels = 0:1,
                              labels = c("No", "Yes")))

ggpairs(pine_fact_tbl, columns = c("DeadDist", 
                                   "TreeDiam", 
                                   "Infest_Serv1", 
                                   "SDI_20th"), ggplot2::aes(color = IND_BA_Infest_20th_fac)) +
          scale_fill_viridis_d("A") +
   scale_color_viridis_d("A")
```

### Things to Note

This is a scatterplot matrix showing the relationships between variables.
<br>
</br>
`IND_BA_Infest_20th` is a variable that shows whether a given tree _is_ or _is not_ within 1/20th acres of an infested tree. Variables like `DeadDist` or `Infest_Serv1` also relate to distance and Pine Beetle infestation. As such, I was interested to see whether dividing the each ggpair correlation into either Yes (an infested tree is within 1/20th acres) or No (an infested tree is not within 1/20th acres) to observe whether there was an observable difference between Yes and No. 
<br>
</br>
It looks like for single-variable distributions (e.g. `TreeDiam` by `TreeDiam`), the groups of points divided by `IND_BA_Infest_20th` varied in whether they were observably different or not. The `TreeDiam` plot did not, which makes sense: why would the presence of a Pine Beetle within 1/20th acres affect the diameter of an already grown tree? `DeadDist`, another variable, has two very distinct groups for Yes and No, which also makes sense as the closer to an infested tree a given tree is, the more likely it is within 1/20th acres of that given tree. 


It looks like there are several , outliers, anything surprising, reasons for choosing certain 
variables in the recipe, things that are not normally distributed, etc. 

Modelling Strategy
==============================================================================

Row {data-height=350}
-----------------------------------------------------------------------

### Predictors

```{r}

```

### Explanation of code

```{r}

```

Conclusion
==============================================================================

### Model Results

```{r}

```

### ROC AUC

```{r}

```

Variable Chart
==============================================================================

### Picture of variables

<img src="../img/variables.png" width="200" height="100">
